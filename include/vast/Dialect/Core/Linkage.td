// Copyright (c) 2022-present, Trail of Bits, Inc.

#ifndef VAST_DIALECT_CORE_IR_LINKAGE
#define VAST_DIALECT_CORE_IR_LINKAGE

include "mlir/IR/EnumAttr.td"

// Linkage types inspired from Clang IR - remove ones present in upstream MLIR

// Linkage types. This is currently a replay of llvm/IR/GlobalValue.h, this is
// currently handy as part of forwarding appropriate linkage types for LLVM
// lowering, specially useful for C++ support.

// Externally visible function
def Global_ExternalLinkage :
  I32EnumAttrCase<"ExternalLinkage", 0, "external">;
// Available for inspection, not emission.
def Global_AvailableExternallyLinkage :
  I32EnumAttrCase<"AvailableExternallyLinkage", 1, "available_externally">;
// Keep one copy of function when linking (inline)
def Global_LinkOnceAnyLinkage :
  I32EnumAttrCase<"LinkOnceAnyLinkage", 2, "linkonce">;
// Same, but only replaced by something equivalent.
def Global_LinkOnceODRLinkage :
  I32EnumAttrCase<"LinkOnceODRLinkage", 3, "linkonce_odr">;
// Keep one copy of named function when linking (weak)
def Global_WeakAnyLinkage :
  I32EnumAttrCase<"WeakAnyLinkage", 4, "weak">;
// Same, but only replaced by something equivalent.
def Global_WeakODRLinkage :
  I32EnumAttrCase<"WeakODRLinkage", 5, "weak_odr">;
// Special purpose, only applies to global arrays
def Global_AppendingLinkage :
    I32EnumAttrCase<"AppendingLinkage", 6, "appending">;
// Rename collisions when linking (static functions).
def Global_InternalLinkage :
  I32EnumAttrCase<"InternalLinkage", 7, "internal">;
// Like Internal, but omit from symbol table.
def Global_PrivateLinkage :
  I32EnumAttrCase<"PrivateLinkage", 8, "private">;
// ExternalWeak linkage description.
def Global_ExternalWeakLinkage :
  I32EnumAttrCase<"ExternalWeakLinkage", 9, "extern_weak">;
// Tentative definitions.
def Global_CommonLinkage :
  I32EnumAttrCase<"CommonLinkage", 10, "common">;

def GlobalLinkageKind : I32EnumAttr<
    "GlobalLinkageKind", "Linkage type/kind",
    [
        Global_ExternalLinkage, Global_AvailableExternallyLinkage,
        Global_LinkOnceAnyLinkage, Global_LinkOnceODRLinkage,
        Global_WeakAnyLinkage, Global_WeakODRLinkage, Global_InternalLinkage,
        Global_PrivateLinkage, Global_ExternalWeakLinkage, Global_CommonLinkage,
        Global_AppendingLinkage
    ]>
{
  let cppNamespace = "::vast::core";
}

#endif // VAST_DIALECT_CORE_IR_LINKAGE
